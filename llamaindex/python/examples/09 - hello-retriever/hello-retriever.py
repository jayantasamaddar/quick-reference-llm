from llama_index import SimpleDirectoryReader, VectorStoreIndex, ServiceContext
from llama_index.llms import OpenAI
from pathlib import Path

__dirname = Path(__file__).resolve().parent
file_path = __dirname.parent.parent.parent / "data" / "essay.txt"

# Load Documents and Create Index
documents = SimpleDirectoryReader(input_files=[file_path]).load_data()
index = VectorStoreIndex.from_documents(documents)

# Define llm
llm = OpenAI(model="gpt-3.5-turbo", temperature=0)

# Specify parameters
service_context = ServiceContext.from_defaults(llm=llm)

# Initialize retriever and use retriever to retrieve nodes.
retriever = index.as_retriever(
    ## Depends on the type of index. For a VectorStoreIndex, specifying `retriever_mode` has no effect (silently ignored).
    retriever_mode="llm",
    ## The number of nodes to query at a time.
    choice_batch_size=10,
    ## A service context.
    service_context=service_context,
)
nodes = retriever.retrieve("Name the people mentioned")

# Response: Return List of nodes with score
print(nodes)
"""
[NodeWithScore(node=TextNode(id_='b5494a62-09c9-48e2-ac4f-f01b76e99c2b', embedding=None, metadata={}, excluded_embed_metadata_keys=[], excluded_llm_metadata_keys=[], relationships={<NodeRelationship.SOURCE: '1'>: RelatedNodeInfo(node_id='a7cfadc0-2f08-4fb5-a17a-3547a84c241f', node_type=None, metadata={}, hash='9d20803c58a7c5674622d8d10cc9ed526632a2956260d4cdd20ab4f55deccc0e'), <NodeRelationship.PREVIOUS: '2'>: RelatedNodeInfo(node_id='e6a0ce7c-f37b-45e6-bbfc-07c9e94d5b76', node_type=None, metadata={}, hash='27627775d75745356c52c6ab390f8cc55a076e8099e0b40d5ac82ddd8291a695')}, hash='91d3db5770b27e3ef24e25e675501d7b03cc41373042916eef8ccc023869ad59', text="[19] One way to get more precise about the concept of invented vs discovered is to talk about space aliens. Any sufficiently advanced alien civilization would certainly know about the Pythagorean theorem, for example. I believe, though with less certainty, that they would also know about the Lisp in McCarthy's 1960 paper.\n\nBut if so there's no reason to suppose that this is the limit of the language that might be known to them. Presumably aliens need numbers and errors and I/O too. So it seems likely there exists at least one path out of McCarthy's Lisp along which discoveredness is preserved.\n\n\n\nThanks to Trevor Blackwell, John Collison, Patrick Collison, Daniel Gackle, Ralph Hazell, Jessica Livingston, Robert Morris, and Harj Taggar for reading drafts of this.", start_char_idx=None, end_char_idx=None, text_template='{metadata_str}\n\n{content}', metadata_template='{key}: {value}', metadata_seperator='\n'), score=0.7559624930336676), NodeWithScore(node=TextNode(id_='3c395d85-2a8f-46fa-9308-9166e153333d', embedding=None, metadata={}, excluded_embed_metadata_keys=[], excluded_llm_metadata_keys=[], relationships={<NodeRelationship.SOURCE: '1'>: RelatedNodeInfo(node_id='a7cfadc0-2f08-4fb5-a17a-3547a84c241f', node_type=None, metadata={}, hash='9d20803c58a7c5674622d8d10cc9ed526632a2956260d4cdd20ab4f55deccc0e'), <NodeRelationship.PREVIOUS: '2'>: RelatedNodeInfo(node_id='4f604ee7-4230-4886-9b36-86361a1e4dad', node_type=None, metadata={}, hash='b62c84f68b7daada0a2d1b63d00eb66a1df7066f4c4f2bc89e0bbdb99b374f9d'), <NodeRelationship.NEXT: '3'>: RelatedNodeInfo(node_id='87e410fb-e048-45ad-8bdd-3b0a112d21d9', node_type=None, metadata={}, hash='6195ecb69ddddf7817842b546e8f7ad2ac357be2b3d4864a1512b6845ab7f83b')}, hash='049b65d4cb81322389004276c46516d48f7606267c872d79b450c94927a40dd0', text='Now all I had to do was learn Italian.\n\nOnly stranieri (foreigners) had to take this entrance exam. In retrospect it may well have been a way of excluding them, because there were so many stranieri attracted by the idea of studying art in Florence that the Italian students would otherwise have been outnumbered. I was in decent shape at painting and drawing from the RISD foundation that summer, but I still don\'t know how I managed to pass the written exam. I remember that I answered the essay question by writing about Cezanne, and that I cranked up the intellectual level as high as I could to make the most of my limited vocabulary. [2]\n\nI\'m only up to age 25 and already there are such conspicuous patterns. Here I was, yet again about to attend some august institution in the hopes of learning about some prestigious subject, and yet again about to be disappointed. The students and faculty in the painting department at the Accademia were the nicest people you could imagine, but they had long since arrived at an arrangement whereby the students wouldn\'t require the faculty to teach anything, and in return the faculty wouldn\'t require the students to learn anything. And at the same time all involved would adhere outwardly to the conventions of a 19th century atelier. We actually had one of those little stoves, fed with kindling, that you see in 19th century studio paintings, and a nude model sitting as close to it as possible without getting burned. Except hardly anyone else painted her besides me. The rest of the students spent their time chatting or occasionally trying to imitate things they\'d seen in American art magazines.\n\nOur model turned out to live just down the street from me. She made a living from a combination of modelling and making fakes for a local antique dealer. She\'d copy an obscure old painting out of a book, and then he\'d take the copy and maltreat it to make it look old. [3]\n\nWhile I was a student at the Accademia I started painting still lives in my bedroom at night. These paintings were tiny, because the room was, and because I painted them on leftover scraps of canvas, which was all I could afford at the time. Painting still lives is different from painting people, because the subject, as its name suggests, can\'t move. People can\'t sit for more than about 15 minutes at a time, and when they do they don\'t sit very still. So the traditional m.o. for painting people is to know how to paint a generic person, which you then modify to match the specific person you\'re painting. Whereas a still life you can, if you want, copy pixel by pixel from what you\'re seeing. You don\'t want to stop there, of course, or you get merely photographic accuracy, and what makes a still life interesting is that it\'s been through a head. You want to emphasize the visual cues that tell you, for example, that the reason the color changes suddenly at a certain point is that it\'s the edge of an object. By subtly emphasizing such things you can make paintings that are more realistic than photographs not just in some metaphorical sense, but in the strict information-theoretic sense. [4]\n\nI liked painting still lives because I was curious about what I was seeing. In everyday life, we aren\'t consciously aware of much we\'re seeing. Most visual perception is handled by low-level processes that merely tell your brain "that\'s a water droplet" without telling you details like where the lightest and darkest points are, or "that\'s a bush" without telling you the shape and position of every leaf. This is a feature of brains, not a bug. In everyday life it would be distracting to notice every leaf on every bush. But when you have to paint something, you have to look more closely, and when you do there\'s a lot to see. You can still be noticing new things after days of trying to paint something people usually take for granted, just as you can after days of trying to write an essay about something people usually take for granted.\n\nThis is not the only way to paint. I\'m not 100% sure it\'s even a good way to paint. But it seemed a good enough bet to be worth trying.\n\nOur teacher, professor Ulivi, was a nice guy. He could see I worked hard, and gave me a good grade, which he wrote down in a sort of passport each student had. But the Accademia wasn\'t teaching me anything except Italian, and my money was running out, so at the end of the first year I went back to the US.', start_char_idx=None, end_char_idx=None, text_template='{metadata_str}\n\n{content}', metadata_template='{key}: {value}', metadata_seperator='\n'), score=0.7523035884264313)]
"""
